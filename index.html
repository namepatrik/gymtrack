<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#e9eef5">
  <title>GymTrack</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="app-header">
    <h1 class="app-title">GymTrack</h1>
    <button id="btnQuickAdd" class="icon-btn" title="Quick add">ï¼‹</button>
  </header>

  <main class="app-main">
    <!-- Log View -->
    <section id="view-log" class="view view-active">
      <div class="card">
        <div class="card-header flex-between">
          <span>Session</span>
          <button id="btnStartSession" class="btn primary">Start</button>
          <button id="btnEndSession" class="btn danger" disabled>End</button>
        </div>
        <div class="card-body">
          <label>
            <span>Start from template</span>
            <select id="startFromTemplate"></select>
          </label>
          <div id="currentSession" class="hidden">
            <p class="muted">Started at <span id="sessionStartTime"></span></p>
            <div id="sessionExerciseList"></div>
          </div>
        </div>
      </div>
      <div class="card flat row gap-m">
        <label class="switch">
          <input type="checkbox" id="toggleTimer">
          <span class="slider"></span>
        </label>
        <input type="number" id="timerSeconds" min="10" step="5" value="90" style="width:80px">
        <button id="btnTimer" class="btn">Start 90s</button>
      </div>
    </section>

    <!-- Programs View -->
    <section id="view-programs" class="view">
      <div class="card">
        <div class="card-header flex-between">
          <span>Programs</span>
          <button id="btnNewTemplate" class="btn primary">ï¼‹ New</button>
        </div>
        <input id="templateSearch" class="input" placeholder="Search templates...">
        <div id="templateList" class="list"></div>
      </div>
    </section>

    <!-- Library View -->
    <section id="view-library" class="view">
      <div class="card">
        <div class="card-header flex-between">
          <span>Exercise Library</span>
          <button id="btnNewExercise" class="btn primary">ï¼‹ New</button>
        </div>
        <input id="exerciseSearch" class="input" placeholder="Search exercises...">
        <select id="exerciseFilter"></select>
        <div id="exerciseList" class="list"></div>
        <div id="exerciseEmpty" class="empty">No exercises yet</div>
      </div>
    </section>

    <!-- Progress View -->
    <section id="view-progress" class="view">
      <div class="card">
        <div class="card-header">Progress</div>
        <label>
          <span>Exercise</span>
          <select id="progressExercise"></select>
        </label>
        <label>
          <span>Metric</span>
          <select id="progressMetric">
            <option value="best">Best Weight</option>
            <option value="volume">Total Volume</option>
            <option value="est1RM">Est 1RM</option>
          </select>
        </label>
        <div class="row">
          <input type="date" id="dateFrom">
          <input type="date" id="dateTo">
          <button id="btnApplyRange" class="btn">Apply</button>
        </div>
        <div class="chart-wrap" style="height:240px">
          <canvas id="progressChart"></canvas>
        </div>
        <div id="chartHint" class="hint"></div>
        <div id="chartPointDetails" class="list compact"></div>
      </div>
    </section>

    <!-- Settings View -->
    <section id="view-settings" class="view">
      <div class="card">
        <div class="card-header">Settings</div>
        <label>
          <span>Units</span>
          <select id="settingUnits">
            <option value="kg">kg</option>
            <option value="lb">lb</option>
          </select>
        </label>
        <label>
          <span>Default Rest Timer (s)</span>
          <input type="number" id="settingTimer" min="10" step="5">
        </label>
        <label>
          <span>Intensity Input</span>
          <select id="settingIntensity">
            <option value="rpe">RPE (1-10)</option>
            <option value="felt">Felt (easy/medium/hard)</option>
          </select>
        </label>
      </div>
      <div class="card">
        <div class="card-header">Backup & Export</div>
        <div class="row gap-s">
          <button id="btnExportJSON" class="btn">Export JSON</button>
          <button id="btnImportJSON" class="btn">Import JSON</button>
          <input id="inputImportJSON" type="file" accept=".json" hidden>
        </div>
        <div class="row gap-s">
          <button id="btnExportCSVAll" class="btn">CSV: All</button>
          <button id="btnExportCSVExercise" class="btn">CSV: Exercise</button>
          <button id="btnExportCSVRange" class="btn">CSV: Date Range</button>
        </div>
      </div>
      <p class="hint">Schema version <span id="schemaVersionNum"></span></p>
    </section>
  </main>

  <!-- Bottom Tabbar -->
  <nav class="tabbar">
    <button class="tab tab-active" data-tab="log"><span class="tab-ico">ğŸ“</span><span class="tab-txt">Log</span></button>
    <button class="tab" data-tab="programs"><span class="tab-ico">ğŸ“‘</span><span class="tab-txt">Programs</span></button>
    <button class="tab" data-tab="library"><span class="tab-ico">ğŸ“š</span><span class="tab-txt">Library</span></button>
    <button class="tab" data-tab="progress"><span class="tab-ico">ğŸ“ˆ</span><span class="tab-txt">Progress</span></button>
    <button class="tab" data-tab="settings"><span class="tab-ico">âš™ï¸</span><span class="tab-txt">Settings</span></button>
  </nav>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Templates for cloning -->
  <template id="tpl-exercise-item">
    <div class="list-item flex-between">
      <div>
        <div class="title"></div>
        <div class="subtitle"></div>
      </div>
      <div class="actions">
        <button class="btn edit">âœï¸</button>
        <button class="btn delete">ğŸ—‘</button>
      </div>
    </div>
  </template>

  <template id="tpl-template-item">
    <div class="list-item flex-between">
      <div>
        <div class="title"></div>
        <div class="subtitle"></div>
      </div>
      <div class="actions">
        <button class="btn edit">âœï¸</button>
        <button class="btn duplicate">ğŸ“„</button>
        <button class="btn delete">ğŸ—‘</button>
      </div>
    </div>
  </template>

  <template id="tpl-template-exercise-row">
    <div class="list-item flex-between">
      <div>
        <div class="title"></div>
        <div class="subtitle"></div>
      </div>
      <div class="actions">
        <button class="btn up">â¬†</button>
        <button class="btn down">â¬‡</button>
        <button class="btn remove">ğŸ—‘</button>
      </div>
    </div>
  </template>

  <template id="tpl-session-exercise">
    <div class="exercise card">
      <div class="exercise-header">
        <div class="title"></div>
        <div class="last-used muted"></div>
      </div>
      <div class="row gap-s">
        <div class="stepper">
          <button class="btn step">-</button>
          <button class="btn step">+</button>
        </div>
        <input type="number" class="weight" placeholder="Weight">
        <div class="stepper">
          <button class="btn step">-</button>
          <button class="btn step">+</button>
        </div>
        <input type="number" class="reps" placeholder="Reps">
        <select class="intensity"></select>
        <button class="btn add-set">Add</button>
      </div>
      <div class="sets list compact"></div>
    </div>
  </template>

  <template id="tpl-set-row">
    <div class="list-item flex-between">
      <div>
        <div class="title"></div>
        <div class="subtitle"></div>
      </div>
      <div class="actions">
        <button class="btn delete">ğŸ—‘</button>
      </div>
    </div>
  </template>

  <!-- Dialogs -->
  <dialog id="dlgExercise" class="modal">
    <form id="exerciseForm" method="dialog" class="form">
      <h3 id="exerciseFormTitle"></h3>
      <input type="hidden" id="exerciseId">
      <label><span>Name</span><input id="exerciseName" required></label>
      <label><span>Muscle group</span><input id="exerciseGroup"></label>
      <label><span>Notes</span><textarea id="exerciseNotes"></textarea></label>
      <menu>
        <button class="btn" value="cancel">Cancel</button>
        <button class="btn primary" type="submit">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgTemplate" class="modal">
    <form id="templateForm" method="dialog" class="form">
      <h3 id="templateFormTitle"></h3>
      <input type="hidden" id="templateId">
      <label><span>Name</span><input id="templateName" required></label>
      <label><span>Notes</span><textarea id="templateNotes"></textarea></label>
      <div id="templateItems" class="list"></div>
      <div class="row gap-s">
        <select id="templateAddExercise"></select>
        <input type="number" id="templateTargetSets" placeholder="Sets" value="3">
        <input type="number" id="templateTargetReps" placeholder="Reps" value="8">
        <button id="btnTemplateAdd" class="btn">ï¼‹</button>
      </div>
      <menu>
        <button class="btn" value="cancel">Cancel</button>
        <button class="btn primary" type="submit">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgConfirm" class="modal">
    <form method="dialog" class="form">
      <h3 id="confirmTitle"></h3>
      <p id="confirmMessage"></p>
      <menu>
        <button class="btn" value="cancel">Cancel</button>
        <button id="btnConfirm" class="btn danger" type="submit">Delete</button>
      </menu>
    </form>
  </dialog>

  <!-- Chart.js: CDN with fallback to local copy -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script>
    if(!window.Chart){
      var s=document.createElement('script');
      s.src='./lib/chart.umd.min.js';
      document.head.appendChild(s);
    }
  </script>

  <!-- App entrypoint -->
  <script type="module" src="app.js"></script>
</body>
</html>
